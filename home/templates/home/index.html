{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map {
    width: 100%;
    height: 500px;
    margin-top: 10px;
  }
</style>
{% endblock %}

{% block content %}
<div id="map"></div>
<div id="countdownTimer"></div>

{% if profile %}
<div class="container profile-containe" id="locations">
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <dl class="row">
            <dt class="col-sm-4"><strong>Location One:</strong></dt>
            <dd class="col-sm-8" id="location_one">{{ profile.location_one }} [{{ profile.location_one_latitude }},  {{ profile.location_one_longitude }}] </dd>
            <!-- <dd class="col-sm-8">{{ profile.location_one_latitude }}</dd>
            <dd class="col-sm-8">{{ profile.location_one_longitude }} </dd> -->

            <dt class="col-sm-4"><strong>Location Two:</strong></dt>
            <dd class="col-sm-8" id="location_two">{{ profile.location_two }}</dd>
          </dl>
        </div>
      </div>
      <p><strong>When you guys will meet:</strong> {{ profile.datetime_field }}</p>
    </div>
  </div>
  <div class="mt-4">
    <a href="{% url 'edit_profile' %}" class="btn btn-warning mr-2">Edit Profile</a>
    <a href="{% url 'delete_profile' %}" class="btn btn-danger">Delete Account</a>
  </div>
</div>
{% else %}
<div class="container mt-5 mb-5">
  <div class="alert alert-warning" role="alert">
    User profile not found.
  </div>
</div>
{% endif %}


{% endblock %}

{% block extra_js %}
<!-- <script src="{% static 'home/js/script.js' %}"></script> -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var map = L.map('map').setView([0, 0], 2); // Set initial coordinates and zoom level

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var locations = document.getElementById('locations');
    if (locations) {
      // locations.addEventListener('submit', function (event) {
      // event.preventDefault(); // Prevent the form from submitting normally

      var locationOne = document.getElementById('location_one').innerHTML;
      var locationTwo = document.getElementById('location_two').innerHTML;

      // Fetch coordinates for locationOne
      $.get(location.protocol + '//nominatim.openstreetmap.org/search?format=json&q=' + locationOne, function (data) {
        var lat1 = data[0].lat;
        var lon1 = data[0].lon;
        var marker1 = L.marker([lat1, lon1]).addTo(map);

        // Fetch coordinates for locationTwo
        $.get(location.protocol + '//nominatim.openstreetmap.org/search?format=json&q=' + locationTwo, function (data) {
          var lat2 = data[0].lat;
          var lon2 = data[0].lon;
          var marker2 = L.marker([lat2, lon2]).addTo(map);

          // Create a Polyline from locationOne to locationTwo
          var polyline = L.polyline([[lat1, lon1], [lat2, lon2]], { color: 'red' }).addTo(map);

          // Fit the map to the bounds of the markers and the polyline
          var bounds = L.latLngBounds([marker1.getLatLng(), marker2.getLatLng()]);
          map.fitBounds(bounds);
        });
      });
      // });
    }
  });

</script>
{% endblock %}